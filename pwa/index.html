<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RSA Driver Attendance</title>

  <!-- PWA manifest served from GitHub Pages (same stable origin) -->
  <link rel="manifest" href="manifest.json">

  <!-- Theme -->
  <meta name="theme-color" content="#0D47A1">

  <!-- iOS standalone support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="RSA Attend">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icon.svg">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; background: #0D47A1; }

    /* Full-screen iframe â€” the GAS app fills the whole viewport */
    #app-frame {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    #app-frame.visible { opacity: 1; }

    /* Splash screen shown while GAS app loads */
    #splash {
      position: fixed;
      inset: 0;
      background: #0D47A1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: opacity 0.5s ease;
    }
    #splash.fade-out { opacity: 0; pointer-events: none; }
    #splash img {
      width: 96px;
      height: 96px;
      border-radius: 22px;
      margin-bottom: 28px;
      animation: pop-in 0.5s cubic-bezier(0.175,0.885,0.32,1.275) both;
    }
    #splash .brand {
      font-family: Arial, sans-serif;
      font-size: 26px;
      font-weight: 700;
      color: #fff;
      animation: fade-up 0.5s 0.2s ease both;
    }
    #splash .sub {
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: rgba(255,255,255,0.6);
      margin-top: 8px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      animation: fade-up 0.5s 0.3s ease both;
    }
    #splash .dots {
      display: flex;
      gap: 10px;
      margin-top: 44px;
      animation: fade-up 0.5s 0.4s ease both;
    }
    #splash .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: rgba(255,255,255,0.3);
      animation: pulse 1.4s ease-in-out infinite;
    }
    #splash .dot:nth-child(2) { animation-delay: 0.22s; }
    #splash .dot:nth-child(3) { animation-delay: 0.44s; }

    @keyframes pop-in  { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes fade-up { from { transform: translateY(12px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes pulse   { 0%,80%,100% { transform: scale(0.85); opacity: 0.3; } 40% { transform: scale(1.3); opacity: 1; } }
  </style>
</head>
<body>

  <!-- Splash shown while iframe loads -->
  <div id="splash">
    <img src="icon.svg" alt="RSA Transport">
    <div class="brand">RSA Transport</div>
    <div class="sub">Driver Attendance</div>
    <div class="dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <!--
    Full-screen iframe that hosts the Google Apps Script web app.
    allow="camera" is required so drivers can take odometer photos.
    *** REPLACE the src URL with your GAS deployment URL ***
  -->
  <iframe
    id="app-frame"
    src="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"
    allow="camera; microphone"
    allowfullscreen
    frameborder="0"
    title="RSA Driver Attendance">
  </iframe>

  <script>
    var frame = document.getElementById('app-frame');
    var splash = document.getElementById('splash');

    function hideSplash() {
      frame.classList.add('visible');
      splash.classList.add('fade-out');
      setTimeout(function() {
        if (splash.parentNode) splash.parentNode.removeChild(splash);
      }, 600);
    }

    // Hide splash when the GAS app finishes loading
    frame.addEventListener('load', hideSplash);

    // Fallback: hide splash after 10 s regardless (slow network, etc.)
    setTimeout(hideSplash, 10000);

    // Register the GitHub Pages service worker.
    // This is what Chrome uses to verify PWA installability.
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js')
          .then(function(reg) {
            console.log('SW registered, scope:', reg.scope);
          })
          .catch(function(err) {
            console.warn('SW registration failed:', err);
          });
      });
    }
  </script>

</body>
</html>
